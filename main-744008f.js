/*
  Copyright (c) 2021-2022 CarrotGeball and stackinspector. All rights reserved. MIT license.
  Source code: https://github.com/stackinspector/ldtstore-homepage
  Commit: 744008f
*/

(function(){const body=document.documentElement,background=document.getElementById("background"),content=document.getElementById("content"),offset=document.getElementById("offset"),major=document.getElementById("major"),side=document.getElementById("side"),search=document.getElementById("search"),back=document.getElementById("back"),load_json=id=>{const el=document.getElementById(id);return el===null?null:JSON.parse(el.innerText)},tools_index=load_json("tools_index"),tools_all=load_json("tools_all"),tools_cross=load_json("tools_cross"),OFFSET_LIT=13,OFFSET={home:33,tool:38}[PAGE_TYPE],copy=text=>{navigator.clipboard.writeText(text)};var LayoutMode;(function(LayoutMode1){LayoutMode1[LayoutMode1.PC=0]="PC",LayoutMode1[LayoutMode1.Pad=1]="Pad",LayoutMode1[LayoutMode1.Phone=2]="Phone"})(LayoutMode||(LayoutMode={}));let layoutMode=LayoutMode.PC;const SideState={distance:300,on:!1,center:!1,id:null,changing:!1};let searchFocus=!1,touchX=0,touchY=0;window.ontouchstart=e=>{touchX=e.touches[0].clientX,touchY=e.touches[0].clientY},window.ontouchend=e=>{const x=e.changedTouches[0].clientX,y=e.changedTouches[0].clientY;touchX-x<-40&&Math.abs((touchY-y)/(touchX-x))<.2&&sideClose()},content.onclick=background.onclick=e=>{(e.composedPath()[0]===content||e.composedPath()[0]===background)&&sideClose()};const sideClose=()=>{sideSet(null)},sideMove=enable=>{SideState.on!==enable&&(SideState.on=enable,SideState.changing=!0,enable?(offset.style.left=`${-SideState.distance}px`,side.style.left=`calc(50% + ${layoutMode===LayoutMode.PC?OFFSET:OFFSET_LIT}em - ${SideState.distance}px)`):(offset.style.left="0",side.style.left=`calc(50% + ${layoutMode===LayoutMode.PC?OFFSET:OFFSET_LIT}em)`,SideState.id=null))},cloneTemplate=template=>document.getElementById(template).content.cloneNode(!0),renderSide=id=>{for(;side.firstChild;)side.removeChild(side.lastChild);if(id.startsWith("tool-")){const name=id.substring(5),index=tools_index[name],cross=tools_cross[name],single=index.list.length===1;side.appendChild(cloneTemplate("side-tools-base"));const title=side.getElementsByClassName("title")[0];title.innerText=single?"\u8BE6\u60C5":index.title;const content1=side.getElementsByClassName("content")[0];for(const tool of index.list){const item=cloneTemplate(`tool-${tool}`).firstElementChild,cross_notice=cross==null?void 0:cross[tool];if(cross_notice!==void 0){const p=document.createElement("p");p.innerHTML=cross_notice,item.getElementsByClassName("detail")[0].appendChild(p)}content1.appendChild(item)}single&&showDetail(side.getElementsByClassName("item")[0])}else side.appendChild(cloneTemplate(`side-${id}`))},renderSearch=keywordText=>{const all=tools_all,content2=document.getElementById("search-content");for(;content2.firstChild;)content2.removeChild(content2.lastChild);for(const tool of Object.keys(all))tool.toLowerCase().includes(keywordText.toLowerCase())&&content2.appendChild(cloneTemplate(`tool-${all[tool]}`))},sideChange=id=>{const enable=id!==null;if(enable&&renderSide(id),side.style.opacity=enable?"1":"0",major.style.visibility=side.style.visibility="visible",SideState.center&&(enable||SideState.id!==null?major.style.opacity="0":major.style.opacity="1"),id==="search"){const keyword=document.getElementById("keyword");keyword.addEventListener("keyup",()=>{renderSearch(keyword.value)})}},sideClick=id=>{sideSet(id)},toolSideClick=id=>{sideSet(`tool-${id}`)};PAGE_TYPE==="tool"&&(search.onclick=e=>{e.stopPropagation(),sideSet("search")},back.onclick=e=>{e.stopPropagation(),location.href="/"});const sideSet=id=>{if(id===null){SideState.id=null,sideMove(!1),sideChange(null);return}SideState.on?SideState.id===id?(SideState.id=null,sideMove(!1),sideChange(null),searchFocus=!1):(SideState.id=id,sideChange(null),searchFocus=id==="search"):(SideState.id=id,sideMove(!0),sideChange(SideState.id),searchFocus=id==="search")};side.addEventListener("transitionend",e=>{e.propertyName==="opacity"&&(major.style.opacity==="0"&&(major.style.visibility="hidden"),side.style.opacity==="0"&&(side.style.visibility="hidden")),e.propertyName==="left"?(recalculate(),SideState.changing&&(SideState.changing=!1)):e.propertyName==="opacity"&&side.style.opacity==="0"&&SideState.id!==null&&sideChange(SideState.id)});const recalculate=()=>{if(searchFocus)return;body.clientWidth>800?layoutMode=LayoutMode.PC:body.clientWidth>500?layoutMode=LayoutMode.Pad:layoutMode=LayoutMode.Phone,content.style.width=`${body.clientWidth}px`,content.style.height=`${body.clientHeight}px`;let scaleW,scaleH;layoutMode===LayoutMode.PC?(scaleW=body.clientWidth/1056,scaleH=body.clientHeight/900):(scaleH=body.clientHeight/880,layoutMode===LayoutMode.Pad?scaleW=body.clientWidth/600:scaleW=body.clientWidth/450),major.style.fontSize=side.style.fontSize=`${Math.min(scaleH,scaleW)}em`;let delta=body.clientHeight-major.clientHeight;if(delta=delta<120?120:delta,delta-=4,side.style.height=`calc(${body.clientHeight-delta}px - 6em)`,major.style.marginTop=side.style.marginTop=major.style.marginBottom=side.style.marginBottom=delta/2+"px",delta=body.clientWidth-major.clientWidth-side.clientWidth,SideState.center=!1,delta>0)SideState.distance=major.offsetLeft-delta/2;else{const delta2=body.clientWidth-major.clientWidth;PAGE_TYPE==="tool"&&delta2<1?(SideState.center=!0,delta=body.clientWidth-side.clientWidth,SideState.distance=side.offsetLeft-delta/2):layoutMode===LayoutMode.Phone?(delta=body.clientWidth-side.clientWidth,SideState.center=!0,SideState.distance=major.clientWidth+major.offsetLeft-delta/2):SideState.distance=-delta+major.offsetLeft}};window.onresize=()=>{searchFocus||(recalculate(),SideState.on?(SideState.id=null,sideClose()):side.style.left=`calc(50% + ${layoutMode===LayoutMode.PC?OFFSET:OFFSET_LIT}em)`)};const showDetail=e=>{const content3=e.getElementsByClassName("detail-container")[0],icon=e.getElementsByClassName("icon-line")[0];if(content3.clientHeight!==0)content3.style.height="0px",icon.style.transform="rotate(0deg)";else{const height=e.getElementsByClassName("detail")[0].clientHeight;content3.style.height=`${height}px`,icon.style.transform="rotate(90deg)"}};return window.copy=copy,window.side=sideClick,window.tool=toolSideClick,window.detail=showDetail,background.style.backgroundImage=`url('//cdn.jsdelivr.net/gh/stackinspector/ldtstore-assert@latest/image/bg/${Math.floor(Math.random()*7)}.webp')`,recalculate(),{}})();
