/*
  Copyright (c) 2021-2022 CarrotGeball and stackinspector. All rights reserved. MIT license.
  Source code: https://github.com/stackinspector/ldtstore-homepage
  Commit: afe24b1
*/

(function(){const DATA=window.__DATA__;delete window.__DATA__;const body=document.documentElement,background=document.getElementById("background"),content=document.getElementById("content"),offset=document.getElementById("offset"),major=document.getElementById("major"),side=document.getElementById("side"),search=document.getElementById("search"),back=document.getElementById("back"),copy=text=>{navigator.clipboard.writeText(text)};var LayoutMode;(function(LayoutMode1){LayoutMode1[LayoutMode1.PC=0]="PC",LayoutMode1[LayoutMode1.Pad=1]="Pad",LayoutMode1[LayoutMode1.Phone=2]="Phone"})(LayoutMode||(LayoutMode={}));let layoutMode=LayoutMode.PC;const RecalculateState={sidePosition:0,distance:300,center:!1},SideState={on:!1,id:null};let touchX=0,touchY=0;window.ontouchstart=e=>{touchX=e.touches[0].clientX,touchY=e.touches[0].clientY},window.ontouchend=e=>{const x=e.changedTouches[0].clientX,y=e.changedTouches[0].clientY;touchX-x<-40&&Math.abs((touchY-y)/(touchX-x))<.2&&sideClose()},content.onclick=background.onclick=e=>{(e.composedPath()[0]===content||e.composedPath()[0]===background)&&sideClose()},DATA.page_type==="tool"&&(search.onclick=e=>{e.stopPropagation(),sideSet("search")},back.onclick=e=>{e.stopPropagation(),location.href="/"});const sideMove=enable=>{SideState.on!==enable&&(SideState.on=enable,enable||(SideState.id=null),positionSet())},setTransitionDuration=(time=.4)=>{offset.style.transitionDuration=side.style.transitionDuration=time+"s"},positionSet=()=>{SideState.on?(offset.style.left=`${-RecalculateState.distance}px`,side.style.left=`${RecalculateState.sidePosition-RecalculateState.distance}px`):(offset.style.left="0",side.style.left=`${RecalculateState.sidePosition}px`)},sideChange=id=>{const enable=id!==null;if(enable&&renderSide(id),side.style.opacity=enable?"1":"0",offset.style.visibility=side.style.visibility="visible",RecalculateState.center?offset.style.opacity=SideState.id===null?"1":"0":offset.style.opacity="1",id==="search"){const keyword=document.getElementById("keyword"),inputTrigger=document.getElementById("inputTrigger");inputTrigger.onclick=()=>{keyword.focus()},keyword.addEventListener("keyup",()=>{renderSearch(keyword.value)}),keyword.focus()}},sideClick=id=>{sideSet(id)},toolSideClick=id=>{sideSet(`tool-${id}`)},sideClose=()=>{sideSet(null)},sideSet=id=>{if(setTransitionDuration(),id===null){SideState.id=null,sideMove(!1),sideChange(null);return}SideState.on?SideState.id===id?sideSet(null):(SideState.id=id,sideChange(null)):(SideState.id=id,sideMove(!0),sideChange(SideState.id))};side.addEventListener("transitionend",e=>{e.propertyName==="opacity"&&(offset.style.visibility=offset.style.opacity==="0"?"hidden":"visible",side.style.visibility=side.style.opacity==="0"?"hidden":"visible",side.style.opacity==="0"&&SideState.id!==null&&sideChange(SideState.id))});const cloneTemplate=template=>document.getElementById(template).content.cloneNode(!0),renderSide=id=>{for(;side.firstChild;)side.removeChild(side.lastChild);if(id.startsWith("tool-")&&DATA.page_type==="tool"){const name=id.substring(5),index=DATA.tool.index[name],cross=DATA.tool.cross[name],single=index.list.length===1;side.appendChild(cloneTemplate("side-tools-base"));const title=side.getElementsByClassName("title")[0];title.innerText=single?"\u8BE6\u60C5":index.title;const content1=side.getElementsByClassName("content")[0];for(const tool of index.list){const item=cloneTemplate(`tool-${tool}`).firstElementChild,cross_notice=cross==null?void 0:cross[tool];if(cross_notice!==void 0){const p=document.createElement("p");p.innerHTML=cross_notice,item.getElementsByClassName("detail")[0].appendChild(p)}content1.appendChild(item)}single&&showDetail(side.getElementsByClassName("item")[0])}else side.appendChild(cloneTemplate(`side-${id}`))},renderSearch=keywordText=>{if(DATA.page_type==="tool"){const all=DATA.tool.all,content2=document.getElementById("search-content");for(;content2.firstChild;)content2.removeChild(content2.lastChild);for(const tool of Object.keys(all))tool.toLowerCase().includes(keywordText.toLowerCase())&&content2.appendChild(cloneTemplate(`tool-${all[tool]}`))}},recalculate=()=>{body.clientWidth>800?layoutMode=LayoutMode.PC:body.clientWidth>500?layoutMode=LayoutMode.Pad:layoutMode=LayoutMode.Phone;let scaleW,scaleH;layoutMode===LayoutMode.PC?(scaleW=body.clientWidth/1056,scaleH=body.clientHeight/900):(scaleH=body.clientHeight/800,layoutMode===LayoutMode.Pad?scaleW=body.clientWidth/600:scaleW=body.clientWidth/450),body.style.fontSize=`${Math.min(scaleH,scaleW)}em`;const delta_major=body.clientWidth-major.clientWidth,delta_side=body.clientWidth-side.clientWidth,delta=body.clientWidth-major.clientWidth-side.clientWidth;delta_major<0?RecalculateState.sidePosition=body.clientWidth:RecalculateState.sidePosition=major.clientWidth+delta_major/2,RecalculateState.center=!1,delta>0?RecalculateState.distance=major.offsetLeft-delta/2:DATA.page_type==="tool"&&delta_major<1?(RecalculateState.center=!0,RecalculateState.distance=side.clientWidth+delta_side/2):delta_side<200?(RecalculateState.center=!0,RecalculateState.distance=major.clientWidth+(-major.clientWidth+side.clientWidth)/2):RecalculateState.distance=-delta+major.offsetLeft,setTransitionDuration(0),positionSet(),SideState.on&&(offset.style.opacity=RecalculateState.center?"0":"1",offset.style.visibility=offset.style.opacity==="0"?"hidden":"visible")};window.onresize=()=>{recalculate()};const showDetail=e=>{const content3=e.getElementsByClassName("detail-container")[0],icon=e.getElementsByClassName("icon-line")[0],height=e.getElementsByClassName("detail")[0].clientHeight;content3.style.height===""&&(content3.style.height="0px"),content3.style.height==="100%"&&(content3.style.transitionDuration=".01s",content3.style.height=`${height}px`,content3.ontransitionend=()=>{content3.style.transitionDuration=".3s",content3.style.height="0px"},icon.style.transform="rotate(0deg)"),content3.style.height==="0px"&&(content3.style.transitionDuration=".3s",content3.style.height=`${height}px`,content3.ontransitionend=()=>{content3.style.height="100%"},icon.style.transform="rotate(90deg)")};return window.copy=copy,window.side=sideClick,window.tool=toolSideClick,DATA.page_type==="tool"&&(window.detail=showDetail),background.style.backgroundImage=`url('//cdn.jsdelivr.net/gh/stackinspector/ldtstore-assert@latest/image/bg/${Math.floor(Math.random()*7)}.webp')`,recalculate(),{}})();
